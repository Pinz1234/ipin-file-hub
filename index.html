<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IPIN FILE HUB</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="bg" aria-hidden="true">
    <span class="g g1"></span>
    <span class="g g2"></span>
    <span class="g g3"></span>
  </div>

  <header class="header">
    <div class="headerInner">
      <div class="logo">IPIN FILE HUB</div>

      <button class="themeBtn" id="themeBtn" type="button" aria-label="Toggle theme">
        <span class="themeIcon" id="themeIcon">Light</span>
        <span class="switch"><span class="knob"></span></span>
      </button>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1 class="title">IPIN SCRIPT</h1>
      <p class="subtitle">
        Koleksi file untuk bot dan tools. Unduh dari daftar di bawah.
      </p>

      <div class="joinWrap">
        <a class="joinBtn" href="https://chat.whatsapp.com/LvA30WKiFgB0t5yFjFmWsz?mode=hqrc" target="_blank" rel="noopener">
          Grup WhatsApp
        </a>
        <a class="joinBtn" href="https://whatsapp.com/channel/0029VbBKScNAInPfll7NHM0O" target="_blank" rel="noopener">
          Channel WhatsApp
        </a>
        <a class="joinBtn" href="https://t.me/IPINSHOP" target="_blank" rel="noopener">
          Telegram
        </a>
        <a class="joinBtn" href="https://youtube.com/@PinshopCik" target="_blank" rel="noopener">
          YouTube
        </a>
      </div>

      <div class="stats">
        <div class="statCard">
          <div class="statNum" id="totalDownloads">0</div>
          <div class="statLabel">Total download (per device)</div>
        </div>
        <div class="statNote">
          Angka ini versi sederhana (per browser). Jika lo mau versi global (semua orang gabung), gw bikinin next.
        </div>
      </div>

      <div class="toolbar">
        <input id="q" class="search" placeholder="Cari file..." />
        <button class="infoBtn" id="openInfo" type="button">Info</button>
      </div>
    </section>

    <section>
      <div id="list" class="grid"></div>
      <div id="empty" class="empty" style="display:none;">Tidak ada hasil.</div>
    </section>
  </main>

  <footer class="footer">
    <span>© IPIN FILE HUB</span>
  </footer>

  <!-- Modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalTop">
        <div class="modalTitle" id="mTitle">Info</div>
        <button class="xBtn" id="mClose" type="button" aria-label="Close">×</button>
      </div>
      <div class="modalText" id="mText"></div>
      <div class="modalActions">
        <a class="ghostBtn" id="mLink" target="_blank" rel="noopener" style="display:none;">Buka</a>
        <button class="primaryBtn" id="mOk" type="button">Tutup</button>
      </div>
    </div>
  </div>

  <!-- IMPORTANT: data.js harus ada di root -->
  <script src="data.js"></script>

  <script>
    // ===== Theme =====
    const root = document.documentElement;
    const themeBtn = document.getElementById("themeBtn");
    const themeIcon = document.getElementById("themeIcon");

    const savedTheme = localStorage.getItem("ipin_theme") || "dark";
    root.setAttribute("data-theme", savedTheme);
    themeIcon.textContent = savedTheme === "dark" ? "Dark" : "Light";

    themeBtn.addEventListener("click", () => {
      const cur = root.getAttribute("data-theme") || "light";
      const next = cur === "dark" ? "light" : "dark";
      root.setAttribute("data-theme", next);
      localStorage.setItem("ipin_theme", next);
      themeIcon.textContent = next === "dark" ? "Dark" : "Light";
    });

    // ===== Modal =====
    const overlay = document.getElementById("overlay");
    const mTitle = document.getElementById("mTitle");
    const mText = document.getElementById("mText");
    const mClose = document.getElementById("mClose");
    const mOk = document.getElementById("mOk");
    const mLink = document.getElementById("mLink");

    function openModal({title, text, url}) {
      mTitle.textContent = title;
      mText.textContent = text;

      if (url) {
        mLink.style.display = "inline-flex";
        mLink.href = url;
      } else {
        mLink.style.display = "none";
        mLink.href = "#";
      }

      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden", "false");
    }
    function closeModal() {
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden", "true");
    }
    overlay.addEventListener("click", (e) => { if (e.target === overlay) closeModal(); });
    mClose.addEventListener("click", closeModal);
    mOk.addEventListener("click", closeModal);

    document.getElementById("openInfo").addEventListener("click", () => {
      openModal({
        title: "Cara pakai",
        text: "Cari file lewat kolom pencarian, lalu tekan Download. Link akan terbuka.",
        url: null
      });
    });

    // Popup sekali per session (rapi, nggak alay)
    if (!sessionStorage.getItem("ipin_popup_once")) {
      sessionStorage.setItem("ipin_popup_once", "1");
      setTimeout(() => openModal({
        title: "Update",
        text: "Gabung Telegram untuk info versi terbaru dan rilis file baru.",
        url: "https://t.me/IPINSHOP"
      }), 900);
    }

    // ===== Download count (per device) =====
    const totalEl = document.getElementById("totalDownloads");
    function getTotal(){ return Number(localStorage.getItem("ipin_total_dl") || 0); }
    function incTotal(){
      const n = getTotal() + 1;
      localStorage.setItem("ipin_total_dl", String(n));
      totalEl.textContent = n;
    }
    totalEl.textContent = getTotal();

    function getPer(link){ return Number(localStorage.getItem("ipin_dl_" + link) || 0); }
    function incPer(link){
      const n = getPer(link) + 1;
      localStorage.setItem("ipin_dl_" + link, String(n));
      return n;
    }

    // ===== Render list (anti “data.js kebaca tapi kosong”) =====
    const listEl = document.getElementById("list");
    const emptyEl = document.getElementById("empty");
    const qEl = document.getElementById("q");

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function getData(){
      // ini yang bikin “pasti kebaca” walau environment beda
      if (typeof scripts !== "undefined" && Array.isArray(scripts)) return scripts;
      if (Array.isArray(window.scripts)) return window.scripts;
      return [];
    }

    function render(filter=""){
      const data = getData();
      listEl.innerHTML = "";

      const f = filter.trim().toLowerCase();
      const items = data.filter(sc => {
        const hay = (sc.name + " " + sc.desc).toLowerCase();
        return !f || hay.includes(f);
      });

      emptyEl.style.display = items.length ? "none" : "block";

      items.forEach((sc, i) => {
        const per = getPer(sc.link);
        const card = document.createElement("article");
        card.className = "card";
        card.style.animationDelay = (i * 0.06) + "s";
        card.innerHTML = `
          <div class="cardTop">
            <div class="cardTitle">${escapeHtml(sc.name)}</div>
            <div class="pill">Free</div>
          </div>
          <div class="cardDesc">${escapeHtml(sc.desc)}</div>
          <div class="cardBottom">
            <button class="primaryBtn dlBtn" type="button">Download</button>
            <div class="dlInfo">Downloaded: <b>${per}</b></div>
          </div>
        `;

        card.querySelector(".dlBtn").addEventListener("click", () => {
          const n = incPer(sc.link);
          card.querySelector(".dlInfo b").textContent = n;
          incTotal();
          window.location.href = sc.link;
        });

        listEl.appendChild(card);
      });
    }

    qEl.addEventListener("input", () => render(qEl.value));
    render();
  </script>
</body>
</html>