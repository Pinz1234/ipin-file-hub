<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IPIN FILE HUB</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="bg" aria-hidden="true">
    <span class="blob b1"></span>
    <span class="blob b2"></span>
    <span class="blob b3"></span>
  </div>

  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand-mini">IPIN FILE HUB</div>
      <button class="theme-toggle" id="themeBtn" type="button" aria-label="Toggle theme">
        <span class="theme-label" id="themeLabel">Dark</span>
        <span class="switch"><span class="knob"></span></span>
      </button>
    </div>
  </header>

  <main class="wrap">
    <section class="hero reveal">
      <div class="hero-badge">Repository</div>
      <h1 class="hero-title">IPIN SCRIPT</h1>
      <p class="hero-subtitle">
        Koleksi file bot dan tools. Pilih dari daftar, lihat detail, lalu unduh.
      </p>

      <div class="hero-actions">
        <a class="join" href="https://chat.whatsapp.com/LvA30WKiFgB0t5yFjFmWsz?mode=hqrc" target="_blank" rel="noopener">Grup WhatsApp</a>
        <a class="join" href="https://whatsapp.com/channel/0029VbBKScNAInPfll7NHM0O" target="_blank" rel="noopener">Channel WhatsApp</a>
        <a class="join" href="https://t.me/IPINSHOP" target="_blank" rel="noopener">Telegram</a>
        <a class="join" href="https://youtube.com/@PinshopCik" target="_blank" rel="noopener">YouTube</a>
      </div>

      <div class="hero-stats">
        <div class="stat">
          <div class="stat-num" id="totalDl">0</div>
          <div class="stat-label">Total download (device)</div>
        </div>
        <div class="stat">
          <div class="stat-num" id="totalFiles">0</div>
          <div class="stat-label">Total file</div>
        </div>
      </div>
    </section>

    <section class="panel reveal">
      <div class="panel-row">
        <input id="q" class="search" placeholder="Cari file..." />
        <button class="btn ghost" id="infoBtn" type="button">Info</button>
      </div>
      <div id="list" class="grid"></div>
      <div id="empty" class="empty" style="display:none;">Tidak ada hasil.</div>
      <div id="err" class="empty" style="display:none;">data.js tidak terbaca. Pastikan file ada di root project.</div>
    </section>

    <footer class="footer">© IPIN FILE HUB</footer>
  </main>

  <!-- Modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-top">
        <div class="modal-title" id="mTitle">Detail</div>
        <button class="x" id="mClose" type="button" aria-label="Close">×</button>
      </div>
      <div class="modal-body">
        <div class="kv"><span>Nama</span><b id="mName">-</b></div>
        <div class="kv"><span>Update</span><b id="mUpdated">-</b></div>
        <div class="kv"><span>Ukuran</span><b id="mSize">-</b></div>
        <div class="kv"><span>Tag</span><b id="mTags">-</b></div>
        <p class="modal-desc" id="mDesc">-</p>
      </div>
      <div class="modal-actions">
        <a class="btn ghost" id="mTelegram" href="https://t.me/IPINSHOP" target="_blank" rel="noopener">Telegram</a>
        <a class="btn primary" id="mDownload" target="_blank" rel="noopener">Download</a>
      </div>
    </div>
  </div>

  <script src="data.js"></script>
  <script>
    // Theme
    const root = document.documentElement;
    const themeBtn = document.getElementById("themeBtn");
    const themeLabel = document.getElementById("themeLabel");
    const saved = localStorage.getItem("ipin_theme") || "dark";
    root.setAttribute("data-theme", saved);
    themeLabel.textContent = saved === "dark" ? "Dark" : "Light";
    themeBtn.addEventListener("click", () => {
      const cur = root.getAttribute("data-theme") || "light";
      const next = cur === "dark" ? "light" : "dark";
      root.setAttribute("data-theme", next);
      localStorage.setItem("ipin_theme", next);
      themeLabel.textContent = next === "dark" ? "Dark" : "Light";
    });

    // Download count (simple: per device)
    const totalDlEl = document.getElementById("totalDl");
    const totalFilesEl = document.getElementById("totalFiles");
    const getTotal = () => Number(localStorage.getItem("ipin_total_dl") || 0);
    const incTotal = () => {
      const n = getTotal() + 1;
      localStorage.setItem("ipin_total_dl", String(n));
      totalDlEl.textContent = n;
    };
    totalDlEl.textContent = getTotal();

    const getPer = (id) => Number(localStorage.getItem("ipin_dl_" + id) || 0);
    const incPer = (id) => {
      const n = getPer(id) + 1;
      localStorage.setItem("ipin_dl_" + id, String(n));
      return n;
    };

    // Modal
    const overlay = document.getElementById("overlay");
    const mClose = document.getElementById("mClose");
    const mTitle = document.getElementById("mTitle");
    const mName = document.getElementById("mName");
    const mUpdated = document.getElementById("mUpdated");
    const mSize = document.getElementById("mSize");
    const mTags = document.getElementById("mTags");
    const mDesc = document.getElementById("mDesc");
    const mDownload = document.getElementById("mDownload");

    function openModal(item){
      mTitle.textContent = "Detail";
      mName.textContent = item.name || "-";
      mUpdated.textContent = item.updated || "-";
      mSize.textContent = item.size || "-";
      mTags.textContent = (item.tags || []).join(", ") || "-";
      mDesc.textContent = item.desc || "-";
      mDownload.href = item.link || "#";
      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden","false");
    }
    function closeModal(){
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
    }
    overlay.addEventListener("click",(e)=>{ if(e.target===overlay) closeModal(); });
    mClose.addEventListener("click", closeModal);

    // Render
    const listEl = document.getElementById("list");
    const emptyEl = document.getElementById("empty");
    const errEl = document.getElementById("err");
    const qEl = document.getElementById("q");

    function esc(s){
      return String(s||"")
        .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }

    function data(){
      if (Array.isArray(window.scripts)) return window.scripts;
      return null;
    }

    function render(filter=""){
      const d = data();
      if (!d){
        errEl.style.display = "block";
        emptyEl.style.display = "none";
        listEl.innerHTML = "";
        totalFilesEl.textContent = "0";
        return;
      }

      errEl.style.display = "none";
      totalFilesEl.textContent = d.length;

      const f = filter.trim().toLowerCase();
      const items = d.filter(x => (x.name + " " + x.desc + " " + (x.tags||[]).join(" ")).toLowerCase().includes(f));
      emptyEl.style.display = items.length ? "none" : "block";
      listEl.innerHTML = "";

      items.forEach((it, i) => {
        const per = getPer(it.id || it.name);
        const card = document.createElement("article");
        card.className = "card reveal";
        card.style.animationDelay = (i * 0.05) + "s";
        card.innerHTML = `
          <div class="card-top">
            <div class="file-icon" aria-hidden="true"></div>
            <div class="card-title">${esc(it.name)}</div>
            <div class="badge">Free</div>
          </div>
          <div class="card-desc">${esc(it.desc)}</div>
          <div class="card-bottom">
            <button class="btn primary">Download</button>
            <button class="btn ghost">Detail</button>
            <div class="dl">Downloaded: <b>${per}</b></div>
          </div>
        `;

        const idKey = it.id || it.name;
        card.querySelector(".btn.primary").addEventListener("click", () => {
          const n = incPer(idKey);
          card.querySelector(".dl b").textContent = n;
          incTotal();
          window.location.href = it.link;
        });

        card.querySelector(".btn.ghost").addEventListener("click", () => openModal(it));
        listEl.appendChild(card);
      });

      // animate reveal (simple)
      document.querySelectorAll(".reveal").forEach(el => el.classList.add("in"));
    }

    qEl.addEventListener("input", () => render(qEl.value));
    document.getElementById("infoBtn").addEventListener("click", () => {
      openModal({
        name: "Informasi",
        updated: "-",
        size: "-",
        tags: ["WhatsApp", "Telegram", "YouTube"],
        desc: "Gunakan pencarian untuk menemukan file. Tombol Detail untuk info singkat, Download untuk membuka link.",
        link: "https://t.me/IPINSHOP"
      });
    });

    render();
  </script>
</body>
</html>