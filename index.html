<!doctype html>
<html lang="id" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>IPIN FILE HUB</title>
  <meta name="description" content="IPIN FILE HUB – Koleksi script gratis.">
  <meta name="theme-color" content="#0f1220">

  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
</head>

<body>
  <!-- BACKGROUND -->
  <div class="bg" aria-hidden="true">
    <span class="blob b1"></span>
    <span class="blob b2"></span>
    <span class="blob b3"></span>
  </div>

  <!-- TOPBAR -->
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand-mini">IPIN FILE HUB</div>

      <button class="theme-toggle click" id="themeBtn" type="button" aria-label="Toggle theme">
        <span class="theme-label" id="themeText">Dark</span>
        <span class="switch" aria-hidden="true"><span class="knob"></span></span>
      </button>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="wrap">
    <section class="hero reveal">
      <h1 class="hero-title">IPIN SCRIPT</h1>
      <p class="hero-subtitle">
        Kumpulan script gratis. Klik detail sebelum download.
      </p>

      <div class="hero-actions">
        <a class="join click" href="https://chat.whatsapp.com/LvA30WKiFgB0t5yFjFmWsz?mode=hqrc" target="_blank" rel="noopener">Grup WhatsApp</a>
        <a class="join click" href="https://whatsapp.com/channel/0029VbBKScNAInPfll7NHM0O" target="_blank" rel="noopener">Channel WhatsApp</a>
        <a class="join click" href="https://t.me/IPINSHOP" target="_blank" rel="noopener">Telegram</a>
        <a class="join click" href="https://youtube.com/@PinshopCik" target="_blank" rel="noopener">YouTube</a>
      </div>
    </section>

    <section class="panel reveal">
      <input id="search" class="search" placeholder="Cari script..." autocomplete="off">
      <div id="list" class="grid"></div>
      <div id="empty" class="empty" style="display:none;">Tidak ada hasil.</div>
      <div id="err" class="empty" style="display:none;">data.js tidak terbaca (cek file di root).</div>
    </section>

    <footer class="footer">© IPIN FILE HUB</footer>
  </main>

  <!-- MODAL DETAIL -->
  <div class="overlay" id="modal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <h3 id="mName" style="margin:0 0 8px;">-</h3>
      <p id="mDesc" style="margin:0; color:var(--muted); line-height:1.6;">-</p>

      <div class="hero-actions" style="margin-top:16px;">
        <a id="mDownload" class="join click" target="_blank" rel="noopener">Download</a>
        <a class="join click" href="https://t.me/IPINSHOP" target="_blank" rel="noopener">Telegram</a>
      </div>

      <div style="margin-top:16px; text-align:center;">
        <button class="join click" id="closeModal" type="button">Tutup</button>
      </div>
    </div>
  </div>

  <!-- POPUP -->
  <div class="overlay" id="popup" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <h3 style="margin:0 0 8px;">Gabung Komunitas</h3>
      <p style="margin:0; color:var(--muted); line-height:1.6;">
        Update script terbaru ada di grup dan Telegram.
      </p>

      <div class="hero-actions" style="margin-top:16px;">
        <a class="join click" href="https://chat.whatsapp.com/LvA30WKiFgB0t5yFjFmWsz?mode=hqrc" target="_blank" rel="noopener">Grup WhatsApp</a>
        <a class="join click" href="https://t.me/IPINSHOP" target="_blank" rel="noopener">Telegram</a>
      </div>

      <div style="margin-top:16px; text-align:center;">
        <button class="join click" id="closePopup" type="button">Tutup</button>
      </div>
    </div>
  </div>

  <script src="data.js"></script>
  <script>
    /* ===============================
       CLICK SOUND (mp3 optional)
       =============================== */
    const sfx = new Audio("click.mp3");
    sfx.volume = 0.06;

    function playClick(){
      try{
        sfx.currentTime = 0;
        sfx.play().catch(()=>{});
      }catch(_){}
    }

    document.addEventListener("click", (e) => {
      if (e.target.closest(".click")) playClick();
    });

    /* ===============================
       THEME
       =============================== */
    const root = document.documentElement;
    const themeBtn = document.getElementById("themeBtn");
    const themeText = document.getElementById("themeText");

    const savedTheme = localStorage.getItem("theme") || "dark";
    root.setAttribute("data-theme", savedTheme);
    themeText.textContent = savedTheme === "dark" ? "Dark" : "Light";
    document.querySelector('meta[name="theme-color"]').setAttribute(
      "content",
      savedTheme === "dark" ? "#0f1220" : "#f6f7ff"
    );

    themeBtn.addEventListener("click", () => {
      const next = root.getAttribute("data-theme") === "dark" ? "light" : "dark";
      root.setAttribute("data-theme", next);
      localStorage.setItem("theme", next);
      themeText.textContent = next === "dark" ? "Dark" : "Light";
      document.querySelector('meta[name="theme-color"]').setAttribute(
        "content",
        next === "dark" ? "#0f1220" : "#f6f7ff"
      );
    });

    /* ===============================
       DATA + RENDER
       =============================== */
    const list = document.getElementById("list");
    const empty = document.getElementById("empty");
    const err = document.getElementById("err");
    const search = document.getElementById("search");

    const modal = document.getElementById("modal");
    const mName = document.getElementById("mName");
    const mDesc = document.getElementById("mDesc");
    const mDownload = document.getElementById("mDownload");
    const closeModal = document.getElementById("closeModal");

    function openModal(item){
      mName.textContent = item.name || "-";
      mDesc.textContent = item.desc || "-";
      mDownload.href = item.link || "#";
      modal.classList.add("show");
      document.body.style.overflow = "hidden";
    }
    function hideModal(){
      modal.classList.remove("show");
      document.body.style.overflow = "";
    }
    closeModal.addEventListener("click", hideModal);
    modal.addEventListener("click", (e) => { if (e.target === modal) hideModal(); });

    function getScripts(){
      if (Array.isArray(window.scripts)) return window.scripts;
      return null;
    }

    function render(filter=""){
      const d = getScripts();
      list.innerHTML = "";

      if(!d){
        err.style.display = "block";
        empty.style.display = "none";
        return;
      }

      err.style.display = "none";
      const f = filter.trim().toLowerCase();

      const items = d.filter(s => {
        const hay = (s.name + " " + (s.desc||"")).toLowerCase();
        return !f || hay.includes(f);
      });

      empty.style.display = items.length ? "none" : "block";

      items.forEach((s) => {
        const card = document.createElement("div");
        card.className = "card reveal";
        card.innerHTML = `
          <h3>${escapeHtml(s.name)}</h3>
          <p>${escapeHtml(s.desc || "")}</p>
          <div class="card-row">
            <button class="join click" type="button">Detail</button>
            <span class="badge">Free</span>
          </div>
        `;
        card.querySelector("button").addEventListener("click", () => openModal(s));
        list.appendChild(card);
      });

      refreshReveal();
    }

    function escapeHtml(str){
      return String(str || "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    search.addEventListener("input", () => render(search.value));

    /* ===============================
       POPUP (ONCE PER SESSION)
       =============================== */
    const popup = document.getElementById("popup");
    const closePopup = document.getElementById("closePopup");
    const POP_KEY = "ipin_popup_v5";

    function showPopup(){
      popup.classList.add("show");
      document.body.style.overflow = "hidden";
    }
    function hidePopup(){
      popup.classList.remove("show");
      document.body.style.overflow = "";
    }
    closePopup.addEventListener("click", hidePopup);
    popup.addEventListener("click", (e) => { if (e.target === popup) hidePopup(); });

    if (!sessionStorage.getItem(POP_KEY)){
      sessionStorage.setItem(POP_KEY, "1");
      setTimeout(showPopup, 900);
    }

    /* ===============================
       REVEAL (LIGHTER)
       =============================== */
    let io;
    function refreshReveal(){
      if (io) io.disconnect();
      const els = document.querySelectorAll(".reveal");

      // fallback for older browsers
      if (!("IntersectionObserver" in window)){
        els.forEach(el => el.classList.add("in"));
        return;
      }

      io = new IntersectionObserver((entries) => {
        entries.forEach(en => {
          if (en.isIntersecting){
            en.target.classList.add("in");
            io.unobserve(en.target);
          }
        });
      }, { rootMargin: "80px" });

      els.forEach(el => io.observe(el));
    }

    /* INIT */
    render("");
    refreshReveal();
  </script>
</body>
</html>